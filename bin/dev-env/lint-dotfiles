#!/usr/bin/env bash
set -euo pipefail

command -v shellcheck >/dev/null || { echo "shellcheck not found"; exit 1; }
command -v shfmt >/dev/null || { echo "shfmt not found"; exit 1; }
command -v yamllint >/dev/null || { echo "yamllint not found"; exit 1; }
command -v codespell >/dev/null || { echo "codespell not found"; exit 1;  }
command -v vale >/dev/null || { echo "vale not found"; exit 1;  }

echo "üîç Linting shell scripts with shellcheck..."
sh_files=("$HOME"/.config/zsh/modules/*.zsh)
if [[ -e "${sh_files[0]}" ]]; then
  for file in "${sh_files[@]}"; do
    shellcheck -x "$file"
  done
else
    echo "‚ÑπÔ∏è No .zsh files found in ~/.config/zsh/modules"
fi

echo "üîç Formatting check for shell scripts with shfmt..."
shfmt -d "$HOME/.config/zsh/modules"

echo "üîç YAML linting..."
if [[ -f "$HOME/.pre-commit-config.yaml" ]]; then
  yamllint "$HOME/.pre-commit-config.yaml"
else
  echo "‚ÑπÔ∏è  No .pre-commit-config.yaml found, skipping YAML linting."
fi

echo "üîç Spellchecking and style linting with codespell..."
codespell "$HOME/.config" "$HOME/bin"

echo "üîç Prose linting with vale..."
if [[ -f "$HOME/.pre-commit-config.yaml" ]]; then
  vale "$HOME/.pre-commit-config.yaml" || true
else
  echo "‚ÑπÔ∏è  No .pre-commit-config.yaml found, skipping Vale check."
fi

echo "‚úÖ All linting checks passed!"
